"use strict";function CssHandler(t,e){this._style=new CssTokenizer(t,e).parse()}function _matchClass(t,e){if(t&&t.length&&e&&e.length){if(1==t.length&&1==e.length)return t[0]==e[0];if(t.length<e.length)return!1;var i=!0,n=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var a=r.value,l=!1,h=!0,c=!1,f=void 0;try{for(var d,u=t[Symbol.iterator]();!(h=(d=u.next()).done);h=!0){d.value==a&&(l=!0)}}catch(t){c=!0,f=t}finally{try{!h&&u.return&&u.return()}finally{if(c)throw f}}if(0==l)return!1}}catch(t){n=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}return!0}return!1}function _matchId(t,e){if(!(t&&t.length&&e&&e.length))return!1;if(1==t.length&&1==e.length)return t[0]==e[0];if(t.length<e.length)return!1;var i=!0,n=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var a=r.value,l=!1,h=!0,c=!1,f=void 0;try{for(var d,u=t[Symbol.iterator]();!(h=(d=u.next()).done);h=!0){d.value==a&&(l=!0)}}catch(t){c=!0,f=t}finally{try{!h&&u.return&&u.return()}finally{if(c)throw f}}if(0==l)return!1}}catch(t){n=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}return!0}function matchClass(t,e,i,n){if("*"==n)return 0;var s=n.match(/^[^\.#\[\]\s]+/),r=n.match(/\.[^\.#\[\]\s]+/g),o=n.match(/#[^\.#\[\]\s]+/g);return o?_matchId(i,o)?r&&!_matchClass(e,r)||s&&t!=s[0]?-1:2:-1:r?_matchClass(e,r)?s&&t!=s[0]?-1:1:-1:s&&t==s[0]?0:-1}function CssTokenizer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.res=this.initClass(e),this._state="SPACE",this._buffer=t,this._sectionStart=0,this._index=0,this._name="",this._content=""}CssHandler.prototype.match=function(t,e,i){var n=[];if(e.class){var s=e.class.split(/\s/),r=!0,o=!1,a=void 0;try{for(var l,h=s[Symbol.iterator]();!(r=(l=h.next()).done);r=!0){var c=l.value;n.push("."+c)}}catch(t){o=!0,a=t}finally{try{!r&&h.return&&h.return()}finally{if(o)throw a}}}var f=[];if(e.id){var s=e.id.split(/\s/),d=!0,u=!1,p=void 0;try{for(var y,_=s[Symbol.iterator]();!(d=(y=_.next()).done);d=!0){var c=y.value;f.push("#"+c)}}catch(t){u=!0,p=t}finally{try{!d&&_.return&&_.return()}finally{if(u)throw p}}}var m,x,g="",v="",C="",b=!1;i.i=[],i.index=[];for(var c=0;c<this._style.length;c++){x=this._style[c],">"==x.key[0]?(m=x.key.substring(1),b=!0):(m=x.key,b=!1);var k=matchClass(t,n,f,m);-1!=k&&(x.hasOwnProperty("index")&&x.index!=x.list.length-1?(i.i.push(c),i.index.push(x.index),x.index++,x.key=x.list[x.index]):0==k?g+=";"+x.content:1==k?v+=";"+x.content:C+=";"+x.content),b&&(i.i.push(c),i.index.push(x.index),x.index--,x.key=x.list[x.index])}return g+";"+v+";"+C+";"},CssHandler.prototype.pop=function(t){if(t.hasOwnProperty("i")){for(var e=0;e<t.i.length;e++)this._style[t.i[e]].key=this._style[t.i[e]].list[t.index[e]],this._style[t.i[e]].index=t.index[e];delete t.i,delete t.index}},CssTokenizer.prototype.initClass=function(t){var e=JSON.parse(JSON.stringify(t));e.a="display:inline;color:#366092;word-break:break-all;"+(e.a||""),e.address="font-style:italic;"+(e.address||""),e.blockquote=e.blockquote||"background-color:#f6f6f6;border-left:3px solid #dbdbdb;color:#6c6c6c;padding:5px 0 5px 10px;",e.center="text-align:center;"+(e.center||""),e.cite="font-style:italic;"+(e.cite||""),e.code=e.code||"padding:0 1px 0 1px;margin-left:2px;margin-right:2px;background-color:#f8f8f8;border:1px solid #cccccc;border-radius:3px;",e.dd="margin-left:40px;"+(e.dd||""),e.img="max-width:100%;"+(e.img||""),e.mark="display:inline;background-color:yellow;"+(e.mark||""),e.pre="overflow:scroll;"+(e.pre||"background-color:#f6f8fa;padding:5px;border-radius:5px;"),e.s="display:inline;text-decoration:line-through;"+(e.s||""),e.u="display:inline;text-decoration:underline;"+(e.u||""),e.big="display:inline;font-size:1.2em;"+(e.big||""),e.small="display:inline;font-size:0.8em;"+(e.small||""),e.pre="font-family:monospace;white-space:pre;"+e.pre;var i=[];for(var n in e)i.push({key:n,content:e[n]});return i},CssTokenizer.prototype.setClass=function(t){var e=[];t.match(/^[^\.#\[\]\s]+/)&&e.push("name"),t.match(/\.[^\.#\[\]\s]+/)&&e.push("class"),t.match(/#[^\.#\[\]\s]+/)&&e.push("id"),/[\s>]/.test(t)?(t=t.replace(/\s*>\s*/g," >").split(/\s/),this.res.push({key:t[0],index:0,list:t,content:this._content,type:e})):this.res.push({key:t,content:this._content,type:e})},CssTokenizer.prototype.SPACE=function(t){/[a-zA-Z.#*]/.test(t)?(this._sectionStart=this._index,this._state="InName"):"@"==t?this._state="Ignore1":"/"==t&&(this._state="BeforeComment")},CssTokenizer.prototype.BeforeComment=function(t){"*"==t?this._state="InComment":(this._index--,this._state="SPACE")},CssTokenizer.prototype.InComment=function(t){"*"==t&&(this._state="AfterComment")},CssTokenizer.prototype.AfterComment=function(t){"/"==t?this._state="SPACE":(this._index--,this._state="InComment")},CssTokenizer.prototype.InName=function(t){"{"==t?(this._name=this._buffer.substring(this._sectionStart,this._index),this._sectionStart=this._index+1,this._state="InContent"):/\s/.test(t)?(this._name=this._buffer.substring(this._sectionStart,this._index),this._state="NameSpace"):/[:\[]/.test(t)&&(this._state="Ignore1")},CssTokenizer.prototype.NameSpace=function(t){"{"==t?(this._sectionStart=this._index+1,this._state="InContent"):/\s/.test(t)||(this._state="InName")},CssTokenizer.prototype.InContent=function(t){if("}"==t){this._content=this._buffer.substring(this._sectionStart,this._index);var e=this._name.split(/\s*,\s*/),i=!0,n=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var a=r.value;this.setClass(a)}}catch(t){n=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}this._state="SPACE"}},CssTokenizer.prototype.Ignore1=function(t){";"==t?(this._state="SPACE",this._sectionStart=this._index+1):"{"==t&&(this._state="Ignore2")},CssTokenizer.prototype.Ignore2=function(t){"}"==t?(this._state="SPACE",this._sectionStart=this._index+1):"{"==t&&(this._state="Ignore3")},CssTokenizer.prototype.Ignore3=function(t){"}"==t&&(this._state="Ignore2")},CssTokenizer.prototype.parse=function(){for(;this._index<this._buffer.length;this._index++)this[this._state](this._buffer[this._index]);return this.res},module.exports=CssHandler;