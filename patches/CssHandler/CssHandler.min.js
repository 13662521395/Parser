"use strict";function CssHandler(t,e){this._style=new CssTokenizer(t,e).parse()}function _matchClass(t,e){if(t&&t.length&&e&&e.length){if(1==t.length&&1==e.length)return t[0]==e[0];if(t.length<e.length)return!1;var n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value,l=!1,h=!0,d=!1,c=void 0;try{for(var f,u=t[Symbol.iterator]();!(h=(f=u.next()).done);h=!0){f.value==a&&(l=!0)}}catch(t){d=!0,c=t}finally{try{!h&&u.return&&u.return()}finally{if(d)throw c}}if(0==l)return!1}}catch(t){i=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return!0}return!1}function _matchId(t,e){if(!(t&&t.length&&e&&e.length))return!1;if(1==t.length&&1==e.length)return t[0]==e[0];if(t.length<e.length)return!1;var n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value,l=!1,h=!0,d=!1,c=void 0;try{for(var f,u=t[Symbol.iterator]();!(h=(f=u.next()).done);h=!0){f.value==a&&(l=!0)}}catch(t){d=!0,c=t}finally{try{!h&&u.return&&u.return()}finally{if(d)throw c}}if(0==l)return!1}}catch(t){i=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return!0}function matchClass(t,e,n,i){if("*"==i)return 0;var r=i.match(/^[^\.#\[\]\s]+/),s=i.match(/\.[^\.#\[\]\s]+/g),o=i.match(/#[^\.#\[\]\s]+/g);return o?_matchId(n,o)?s&&!_matchClass(e,s)||r&&t!=r[0]?-1:2:-1:s?_matchClass(e,s)?r&&t!=r[0]?-1:1:-1:r&&t==r[0]?0:-1}function CssTokenizer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.res=this.initClass(e),this._state="SPACE",this._buffer=t,this._sectionStart=0,this._index=0,this._name="",this._content=""}CssHandler.prototype.match=function(t,e,n){var i=[];if(e.class){var r=e.class.split(/\s/),s=!0,o=!1,a=void 0;try{for(var l,h=r[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var d=l.value;i.push("."+d)}}catch(t){o=!0,a=t}finally{try{!s&&h.return&&h.return()}finally{if(o)throw a}}}var c=[];if(e.id){var r=e.id.split(/\s/),f=!0,u=!1,p=void 0;try{for(var y,_=r[Symbol.iterator]();!(f=(y=_.next()).done);f=!0){var d=y.value;c.push("#"+d)}}catch(t){u=!0,p=t}finally{try{!f&&_.return&&_.return()}finally{if(u)throw p}}}var x,m,g="",v="",C="",b=!1;n.i=[],n.index=[],n.pseudo=[];for(var d=0;d<this._style.length;d++){m=this._style[d],">"==m.key[0]?(x=m.key.substring(1),b=!0):(x=m.key,b=!1);var k=matchClass(t,i,c,x);-1!=k&&(m.hasOwnProperty("index")&&m.index!=m.list.length-1?(n.i.push(d),n.index.push(m.index),m.index++,m.key=m.list[m.index]):m.pseudo?n.pseudo.push(m):0==k?g+=";"+m.content:1==k?v+=";"+m.content:C+=";"+m.content),b&&(n.i.push(d),n.index.push(m.index),m.index--,m.key=m.list[m.index])}return n.i.length||(delete n.i,delete n.index),n.pseudo.length||delete n.pseudo,g+";"+v+";"+C+";"},CssHandler.prototype.pop=function(t){if(t.hasOwnProperty("i")){for(var e=0;e<t.i.length;e++)this._style[t.i[e]].key=this._style[t.i[e]].list[t.index[e]],this._style[t.i[e]].index=t.index[e];delete t.i,delete t.index}if(t.hasOwnProperty("pseudo")){var n=!0,i=!1,r=void 0;try{for(var s,o=t.pseudo[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a,l=s.value,h=l.content.replace(/content\s*:\s*['"]([\S]*?)['"];*/,function(){return a=arguments[1],""}),d={name:"span",attrs:{style:h},children:[{type:"text",text:a}]};"before"==l.pseudo?t.children.unshift(d):t.children.push(d)}}catch(t){i=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}}},CssTokenizer.prototype.initClass=function(t){var e=JSON.parse(JSON.stringify(t));e.a="display:inline;color:#366092;word-break:break-all;"+(e.a||""),e.address="font-style:italic;"+(e.address||""),e.blockquote=e.blockquote||"background-color:#f6f6f6;border-left:3px solid #dbdbdb;color:#6c6c6c;padding:5px 0 5px 10px;",e.center="text-align:center;"+(e.center||""),e.cite="font-style:italic;"+(e.cite||""),e.code=e.code||"padding:0 1px 0 1px;margin-left:2px;margin-right:2px;background-color:#f8f8f8;border:1px solid #cccccc;border-radius:3px;",e.dd="margin-left:40px;"+(e.dd||""),e.img="max-width:100%;"+(e.img||""),e.mark="display:inline;background-color:yellow;"+(e.mark||""),e.pre="overflow:scroll;"+(e.pre||"background-color:#f6f8fa;padding:5px;border-radius:5px;"),e.s="display:inline;text-decoration:line-through;"+(e.s||""),e.u="display:inline;text-decoration:underline;"+(e.u||""),e.big="display:inline;font-size:1.2em;"+(e.big||""),e.small="display:inline;font-size:0.8em;"+(e.small||""),e.pre="font-family:monospace;white-space:pre;"+e.pre;var n=[];for(var i in e)n.push({key:i,content:e[i]});return n},CssTokenizer.prototype.setClass=function(t){var e;if(/:/.test(t)){var n=t.split(/\s*:+\s*/);if(t=n[0],"before"!=(e=n[1])&&"after"!=e)return}/[\s>]/.test(t)?(t=t.replace(/\s*>\s*/g," >").split(/\s/),this.res.push({key:t[0],index:0,list:t,content:this._content,pseudo:e})):this.res.push({key:t,content:this._content,pseudo:e})},CssTokenizer.prototype.SPACE=function(t){/[a-zA-Z.#*]/.test(t)?(this._sectionStart=this._index,this._state="InName"):"@"==t?this._state="Ignore1":"/"==t&&(this._state="BeforeComment")},CssTokenizer.prototype.BeforeComment=function(t){"*"==t?this._state="InComment":(this._index--,this._state="SPACE")},CssTokenizer.prototype.InComment=function(t){"*"==t&&(this._state="AfterComment")},CssTokenizer.prototype.AfterComment=function(t){"/"==t?this._state="SPACE":(this._index--,this._state="InComment")},CssTokenizer.prototype.InName=function(t){"{"==t?(this._name=this._buffer.substring(this._sectionStart,this._index),this._sectionStart=this._index+1,this._state="InContent"):/\s/.test(t)?(this._name=this._buffer.substring(this._sectionStart,this._index),this._state="NameSpace"):/[\[]/.test(t)&&(this._state="Ignore1")},CssTokenizer.prototype.NameSpace=function(t){"{"==t?(this._sectionStart=this._index+1,this._state="InContent"):/\s/.test(t)||(this._state="InName")},CssTokenizer.prototype.InContent=function(t){if("}"==t){this._content=this._buffer.substring(this._sectionStart,this._index);var e=this._name.split(/\s*,\s*/),n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value;this.setClass(a)}}catch(t){i=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}this._state="SPACE"}},CssTokenizer.prototype.Ignore1=function(t){";"==t?(this._state="SPACE",this._sectionStart=this._index+1):"{"==t&&(this._state="Ignore2")},CssTokenizer.prototype.Ignore2=function(t){"}"==t?(this._state="SPACE",this._sectionStart=this._index+1):"{"==t&&(this._state="Ignore3")},CssTokenizer.prototype.Ignore3=function(t){"}"==t&&(this._state="Ignore2")},CssTokenizer.prototype.parse=function(){for(;this._index<this._buffer.length;this._index++)this[this._state](this._buffer[this._index]);return this.res},module.exports=CssHandler;