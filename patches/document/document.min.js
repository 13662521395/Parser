"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),MpHtmlParser=require("./MpHtmlParser.js"),element=function(){function t(e,n,s){_classCallCheck(this,t),e.attrs=e.attrs||{},e.children=e.children||[],this.nodeName=e.name,this.id=e.attrs.id,this._node=e,this.childNodes=[];for(var i=0;i<e.children.length;i++)e.children[i].name&&this.childNodes.push(new t(e.children[i],n+".children["+i+"]",this._context));this.attributes=this._node.attrs,this.style={};for(var r=(e.attrs.style||"").split(";"),i=0;i<r.length;i++)if(r[i].includes(":")){var h=r[i].split(":");this.style[h[0]]=h[1]}this._path=n,this._context=s,this._dirty=!1}return _createClass(t,[{key:"appendChild",value:function(e){return e.constructor==t&&(this.childNodes.push(e),this._node.children.push(e._node),e.path=this._path+".children["+(this._node.children.length-1)+"]",this._setData(),!0)}},{key:"removeChild",value:function(e){if(e.constructor!=t)return!1;var n=this.childNodes.indexOf(e);return-1!=n&&(this.childNodes.splice(n,1),this._node.children.splice(n,1),this._setData(),!0)}},{key:"replaceChild",value:function(e,n){if(e.constructor!=t)return!1;if(n.constructor!=t)return!1;var s=this.childNodes.indexOf(child);return-1!=s&&(this.childNodes[s]=n,this._node.children[s]=n._node,n.path=this._path+".children["+s+"]",!0)}},{key:"getAttribute",value:function(t){return this._node.attrs.hasOwnProperty(t)?this._node.attrs[t]:null}},{key:"setAttribute",value:function(t,e){return this._node.attrs[t]=e,this._setData(),!0}},{key:"getStyle",value:function(t){return t=t.replace(/(A-Z)/g,"-$1").toLowerCase(),this.style.hasOwnProperty(t)?this.style[t]:null}},{key:"setStyle",value:function(t,e){if(t=t.replace(/(A-Z)/g,"-$1").toLowerCase(),this.style.hasOwnProperty(t)){this.style[t]=e;var n="";for(var s in this.style)n+=s+":"+this.style[s]+";";this._node.attrs.style=n}else this._node.attrs.style=(this._node.attrs.style||"")+";"+t+":"+e;return this._setData(),!0}},{key:"_search",value:function(e,n,s,i){if("text"!=e.type){if("id"==i&&e.attrs&&e.attrs.id==s)return this._nodeList.push(new t(e,n,this._context));if(("name"==i&&e.name==s||"class"==i&&e.attrs&&e.attrs.class==s)&&this._nodeList.push(new t(e,n,this._context)),e.children&&e.children.length)for(var r=e.children.length;r--;)this._search(e.children[r],n+".children["+r+"]",s,i)}}},{key:"getElementById",value:function(t){return this._nodeList=[],this._search(this._node,this._path,t,"id"),this._nodeList[0]}},{key:"getElementsByClassName",value:function(t){return this._nodeList=[],this._search(this._node,this._path,t,"class"),this._nodeList}},{key:"getElementsByTagName",value:function(t){return this._nodeList=[],this._search(this._node,this._path,t,"name"),this._nodeList}},{key:"_setData",value:function(){var t=this;this._dirty=!0,setTimeout(function(){t._dirty&&(t._context._refresh=!0,t._context.setData(_defineProperty({},t._path,t._node)),t._dirty=!1)},0)}},{key:"innerText",get:function(){return this._context.getText([this._node])},set:function(t){this._node.children=[{type:"text",text:t}],this.childNodes=[],this._setData()}},{key:"innerHtml",get:function(){return function t(e){var n="";if("text"==e.type)n+=e.text;else{n+="<"+e.name;for(var s in e.attrs)e.attrs[s]&&(n+=" "+s+'="'+e.attrs[s]+'"');if(e.children&&e.children.length){n+=">";for(var i=0;i<e.children.length;i++)n+=t(e.children[i]);n+="</"+e.name+">"}else n+="/>"}return n}(this._node)},set:function(e){this._node.children=new MpHtmlParser(e,this._context.data).parse();for(var n=0;n<this._node.children.length;n++)this._node.children[n].name&&this.childNodes.push(new t(this._node.children[n],path+".children["+n+"]",this._context))}}]),t}(),dom=function(){function t(e,n,s){_classCallCheck(this,t),this._nodes=e,this._path=n,this._context=s}return _createClass(t,[{key:"_search",value:function(t,e,n,s){for(var i,r=0;i=(t||[])[r];r++)if("text"!=i.type){if("id"==s&&i.attrs&&i.attrs.id==n)return this._nodeList.push(new element(i,e+"["+r+"]",this._context));("name"==s&&i.name==n||"class"==s&&i.attrs&&i.attrs.class==n)&&this._nodeList.push(new element(i,e+"["+r+"]",this._context)),this._search(i.children,e+"["+r+"].children",n,s)}}},{key:"getElementById",value:function(t){return this._nodeList=[],this._search(this._nodes,this._path,t,"id"),this._nodeList[0]}},{key:"getElementsByClassName",value:function(t){return this._nodeList=[],this._search(this._nodes,this._path,t,"class"),this._nodeList}},{key:"getElementsByTagName",value:function(t){return this._nodeList=[],this._search(this._nodes,this._path,t,"name"),this._nodeList}},{key:"createElement",value:function(t){return new element({name:t},"",this._context)}},{key:"write",value:function(t){return this._context.setData(_defineProperty({},this._path,t.constructor==Array?t:new MpHtmlParser(t,this._context.data).parse())),!0}}]),t}();module.exports=dom;