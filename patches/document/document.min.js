function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function element(t,e,n){t.attrs=t.attrs||{},t.children=t.children||[],this.nodeName=t.name,this.id=t.attrs.id,this._node=t,this.childNodes=[];for(var i=0;i<t.children.length;i++)t.children[i].name&&this.childNodes.push(new element(t.children[i],e+".children["+i+"]",this._context));this.attributes=this._node.attrs,this.style={};for(var s=(t.attrs.style||"").split(";"),r=0;r<s.length;r++)if(s[r].includes(":")){var h=s[r].split(":");this.style[h[0]]=h[1]}this._path=e,this._context=n,this._dirty=!1}function dom(t){this._path="html",this._context=t}var MpHtmlParser=require("./MpHtmlParser.js");element.prototype.__defineGetter__("innerText",function(){return this._context.getText([this._node])}),element.prototype.__defineSetter__("innerText",function(t){this._node.children=[{type:"text",text:t}],this.childNodes=[],this._setData()}),element.prototype.__defineGetter__("outerHTML",function(){return function t(e){var n="";if("text"==e.type)n+=e.text;else{n+="<"+e.name;for(var i in e.attrs)e.attrs[i]&&(n+=" "+i+'="'+e.attrs[i]+'"');if(e.children&&e.children.length){n+=">";for(var s=0;s<e.children.length;s++)n+=t(e.children[s]);n+="</"+e.name+">"}else n+="/>"}return n}(this._node)}),element.prototype.__defineGetter__("innerHTML",function(){var t=this.outerHTML;return t.substring(t.indexOf(">")+1,t.lastIndexOf("<"))}),element.prototype.__defineSetter__("innerHTML",function(t){this._node.children=new MpHtmlParser(t,this._context.data).parse();for(var e=0;e<this._node.children.length;e++)this._node.children[e].name&&this.childNodes.push(new element(this._node.children[e],this._path+".children["+e+"]",this._context));this._setData()}),element.prototype.appendChild=function(t){return t.constructor==element&&(this.childNodes.push(t),this._node.children.push(t._node),t.path=this._path+".children["+(this._node.children.length-1)+"]",this._setData(),!0)},element.prototype.removeChild=function(t){if(t.constructor!=element)return!1;var e=this.childNodes.indexOf(t);return-1!=e&&(this.childNodes.splice(e,1),this._node.children.splice(e,1),this._setData(),!0)},element.prototype.replaceChild=function(t,e){if(e.constructor!=element)return!1;if(t.constructor!=element)return!1;var n=this.childNodes.indexOf(e);return-1!=n&&(this.childNodes[n]=t,this._node.children[n]=t._node,t.path=this._path+".children["+n+"]",this._setData(),!0)},element.prototype.getAttribute=function(t){return Object.hasOwnProperty.call(this._node.attrs,t)?this._node.attrs[t]:null},element.prototype.setAttribute=function(t,e){return this._node.attrs[t]=e,this._setData(),!0},element.prototype.getStyle=function(t){return t=t.replace(/(A-Z)/g,"-$1").toLowerCase(),Object.hasOwnProperty.call(this.style,t)?this.style[t]:null},element.prototype.setStyle=function(t,e){if(t=t.replace(/(A-Z)/g,"-$1").toLowerCase(),Object.hasOwnProperty.call(this.style,t)){this.style[t]=e;var n="";for(var i in this.style)n+=i+":"+this.style[i]+";";this._node.attrs.style=n}else this._node.attrs.style=(this._node.attrs.style||"")+";"+t+":"+e;return this._setData(),!0},element.prototype._search=function(t,e,n,i){if("text"!=t.type){if("id"==i&&t.attrs&&t.attrs.id==n)return this._nodeList.push(new element(t,e,this._context));if(("name"==i&&t.name==n||"class"==i&&t.attrs&&t.attrs.class==n)&&this._nodeList.push(new element(t,e,this._context)),t.children&&t.children.length)for(var s=t.children.length;s--;)this._search(t.children[s],e+".children["+s+"]",n,i)}},element.prototype.getElementById=function(t){return this._nodeList=[],this._search(this._node,this._path,t,"id"),this._nodeList[0]},element.prototype.getElementsByClassName=function(t){return this._nodeList=[],this._search(this._node,this._path,t,"class"),this._nodeList},element.prototype.getElementsByTagName=function(t){return this._nodeList=[],this._search(this._node,this._path,t,"name"),this._nodeList},element.prototype._setData=function(){var t=this;this._path&&(this._dirty=!0,setTimeout(function(){t._dirty&&(t._context._refresh=!0,t._context.setData(_defineProperty({},t._path,t._node)),t._dirty=!1)},0))},dom.prototype._search=function(t,e,n,i){for(var s,r=0;s=(t||[])[r];r++)if("text"!=s.type){if("id"==i&&s.attrs&&s.attrs.id==n)return this._nodeList.push(new element(s,e+"["+r+"]",this._context));("name"==i&&s.name==n||"class"==i&&s.attrs&&s.attrs.class==n)&&this._nodeList.push(new element(s,e+"["+r+"]",this._context)),this._search(s.children,e+"["+r+"].children",n,i)}},dom.prototype.__defineGetter__("body",function(){return new element({name:"body",children:this._context.data.html},"html",this._context)}),dom.prototype.getElementById=function(t){return this._nodeList=[],this._search(this._context.data.html,"html",t,"id"),this._nodeList[0]},dom.prototype.getElementsByClassName=function(t){return this._nodeList=[],this._search(this._context.data.html,"html",t,"class"),this._nodeList},dom.prototype.getElementsByTagName=function(t){return this._nodeList=[],this._search(this._context.data.html,"html",t,"name"),this._nodeList},dom.prototype.createElement=function(t){return new element({name:t},"",this._context)},dom.prototype.write=function(t){return this._context.setData({html:t.constructor==Array?t:new MpHtmlParser(t,this._context.data).parse()}),!0},module.exports=dom;