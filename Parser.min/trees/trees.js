/* Parser富文本插件 https://github.com/jin-yufeng/Parser */
"use strict";Component({data:{imgLoad:!1},created:function(){var t=this;this.triggerError=function(r,e,o,a,i){t._top&&t._top.triggerEvent("error",{source:r,target:e,errMsg:o,errCode:a,context:i})},this.loadSource=function(r){return!t.data.controls[r.id]&&r.source.length>1?(t.data.controls[r.id]={play:!1,index:1},t.setData({controls:t.data.controls}),!0):!!(t.data.controls[r.id]&&r.source.length>t.data.controls[r.id].index+1)&&(t.data.controls[r.id].index++,t.setData({controls:t.data.controls}),!0)}},detached:function(){this._observer&&this._observer.disconnect()},properties:{nodes:{type:Array,value:[]},controls:{type:Object,value:{}}},methods:{playEvent:function(t){if(this._top&&this._top.videoContexts.length>1&&this._top.data.autopause){var r=!0,e=!1,o=void 0;try{for(var a,i=this._top.videoContexts[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var n=a.value;n.id!=t.currentTarget.dataset.id&&n.pause()}}catch(t){e=!0,o=t}finally{try{!r&&i.return&&i.return()}finally{if(e)throw o}}}},previewEvent:function(t){if(this._top&&!t.target.dataset.hasOwnProperty("ignore")){var r=!0,e=t.currentTarget.dataset.src;this._top.triggerEvent("imgtap",{id:t.currentTarget.id,src:e,ignore:function(){return r=!1}}),r&&this._top.data.autopreview&&wx.previewImage({current:e,urls:this._top.imgList.length?this._top.imgList:[e]})}},tapEvent:function(t){if(this._top){var r=!0,e=t.currentTarget.dataset.href;this._top.triggerEvent("linkpress",{href:e,ignore:function(){return r=!1}}),r&&e&&("#"==e[0]?this._top.data.useAnchor&&this._top.navigateTo({id:e.substring(1)}):/^http/.test(e)?this._top.data.autocopy&&wx.setClipboardData({data:e,success:function(){wx.showToast({title:"链接已复制"})}}):wx.navigateTo({url:e}))}},adError:function(t){this.triggerError("ad",t.currentTarget,t.detail.errMsg,t.detail.errCode)},videoError:function(t){!this.loadSource(t.currentTarget.dataset)&&this._top&&this.triggerError("video",t.currentTarget,t.detail.errMsg,void 0,this._top.getVideoContext(t.currentTarget.id))},audioError:function(t){this.loadSource(t.currentTarget.dataset)||this.triggerError("audio",t.currentTarget,t.detail.errMsg)},loadVideo:function(t){this.data.controls[t.currentTarget.dataset.id]={play:!0,index:0},this.setData({controls:this.data.controls})}}});