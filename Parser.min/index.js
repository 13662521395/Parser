"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},html2nodes=require("./Parser.js"),initData=function(t){setTimeout(function(){t.createSelectorQuery().select("#contain").boundingClientRect(function(e){t.triggerEvent("ready",e)}).exec(),t.videoContext=[];var e=[t.selectComponent("#contain")];e=e.concat(t.selectAllComponents("#contain>>>#node"));var i=!0,o=!1,a=void 0;try{for(var n,r=e[Symbol.iterator]();!(i=(n=r.next()).done);i=!0){var s=n.value,l=!0,d=!1,u=void 0;try{for(var c,y=s.data.nodes[Symbol.iterator]();!(l=(c=y.next()).done);l=!0){var h=c.value;"video"==h.name?t.videoContext.push({id:h.attrs.id,context:wx.createVideoContext(h.attrs.id,s)}):"audio"==h.name&&h.attrs.autoplay&&wx.createAudioContext(h.attrs.id,s).play()}}catch(t){d=!0,u=t}finally{try{!l&&y.return&&y.return()}finally{if(d)throw u}}}}catch(t){o=!0,a=t}finally{try{!i&&r.return&&r.return()}finally{if(o)throw a}}},10)};Component({properties:{html:{type:null,value:"",observer:function(t){var e=this,i={},o={};if(this.data.showWithAnimation&&(i=wx.createAnimation({duration:this.data.animationDuration,timingFunction:"ease"}).opacity(0).step().export(),o=wx.createAnimation({duration:this.data.animationDuration,timingFunction:"ease"}).opacity(1).step().export()),t)if("string"==typeof t)html2nodes(t,this.data.tagStyle).then(function(t){e.setData({nodes:t.nodes,controls:{imgMode:e.data.imgMode},showAnimation:o,hideAnimation:i},initData(e)),t.title&&e.data.autosetTitle&&wx.setNavigationBarTitle({title:t.title}),e.imgList=t.imgList,e.triggerEvent("parse",t)}).catch(function(t){e.triggerEvent("error",t)});else if(t.constructor==Array)this.setData({controls:{imgMode:this.data.imgMode},showAnimation:o,hideAnimation:i},initData(this)),this.imgList=[];else if("object"==(void 0===t?"undefined":_typeof(t))){if(!t.nodes||t.nodes.constructor!=Array)return void this.triggerEvent("error",{message:"传入的nodes数组格式不正确！应该传入的类型是array，实际传入的类型是："+_typeof(t.nodes)});this.setData({controls:{imgMode:this.data.imgMode},showAnimation:o,hideAnimation:i},initData(this)),t.title&&this.data.autosetTitle&&wx.setNavigationBarTitle({title:t.title}),this.imgList=t.imgList||[]}else this.triggerEvent("error",{message:"错误的html类型："+(void 0===t?"undefined":_typeof(t))});else this.setData({nodes:[]})}},autocopy:{type:Boolean,value:!0},autopause:{type:Boolean,value:!0},autopreview:{type:Boolean,value:!0},autosetTitle:{type:Boolean,value:!0},imgMode:{type:String,value:"default"},selectable:{type:Boolean,value:!1},tagStyle:{type:Object,value:{}},showWithAnimation:{type:Boolean,value:!1},animationDuration:{type:Number,value:400}},methods:{tapEvent:function(t){this.data.autocopy&&t.detail&&/^http/.test(t.detail)&&wx.setClipboardData({data:t.detail,success:function(){wx.showToast({title:"链接已复制"})}}),this.triggerEvent("linkpress",t.detail)},errorEvent:function(t){this.triggerEvent("error",t.detail)},previewEvent:function(t){this.data.autopreview&&wx.previewImage({current:t.detail,urls:this.imgList.length?this.imgList:[t.detail]}),this.triggerEvent("imgtap",t.detail)},_playVideo:function(t){if(this.videoContext.length>1&&this.data.autopause){var e=!0,i=!1,o=void 0;try{for(var a,n=this.videoContext[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var r=a.value;r.id!=t.detail&&r.context.pause()}}catch(t){i=!0,o=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw o}}}}}});