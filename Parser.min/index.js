"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Document;try{Document=require("./document.js")}catch(t){}var html2nodes=require("./Parser.js"),CanIUseObserver=require("./api.js").versionHigherThan("1.9.3"),CanIUseNextTick=wx.canIUse("nextTick"),initData=function(t){t.navigateTo=function(e){function i(i){var o=t.createSelectorQuery();o.select(i).boundingClientRect(),o.selectViewport().scrollOffset(),o.exec(function(t){if(!t||!t[0])return e.fail({errMsg:"Label Not Found"});wx.pageScrollTo({scrollTop:t[1].scrollTop+t[0].top,success:e.success,fail:e.fail})})}e.success=e.success||function(){},e.fail=e.fail||function(){},i(e.id?"#contain >>> #"+e.id:"#contain")},t.createSelectorQuery().select("#contain").boundingClientRect(function(e){t.triggerEvent("ready",e)}).exec(),t.videoContext=[];var e=[t.selectComponent("#contain")];e=e.concat(t.selectAllComponents("#contain>>>.node"));var i=!0,o=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done);i=!0)!function(){var e=a.value,i=!1,o=!0,n=!1,r=void 0;try{for(var s,c=e.data.nodes[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=s.value;"img"!=l.name||i?"video"==l.name?t.videoContext.push({id:l.attrs.id,context:wx.createVideoContext(l.attrs.id,e)}):"audio"==l.name&&l.attrs.autoplay&&wx.createAudioContext(l.attrs.id,e).play():(i=!0,e.data.lazyLoad&&CanIUseObserver?(e._observer=e.createIntersectionObserver(),e._observer.relativeToViewport({top:1e3,bottom:1e3}).observe(".img",function(t){e.setData({imgLoad:!0}),e._observer.disconnect(),e._observer=null})):e.setData({imgLoad:!0}))}}catch(t){n=!0,r=t}finally{try{!o&&c.return&&c.return()}finally{if(n)throw r}}}()}catch(t){o=!0,n=t}finally{try{!i&&r.return&&r.return()}finally{if(o)throw n}}};Component({properties:{html:{type:null,value:"",observer:function(t){var e=this,i={},o={};if(this.data.showWithAnimation&&(i=wx.createAnimation({duration:this.data.animationDuration,timingFunction:"ease"}).opacity(0).step().export(),o=wx.createAnimation({duration:this.data.animationDuration,timingFunction:"ease"}).opacity(1).step().export()),t)if("string"==typeof t)html2nodes(t,this.data).then(function(t){e.setData({nodes:t.nodes,controls:{imgMode:e.data.imgMode},showAnimation:o,hideAnimation:i}),CanIUseNextTick?wx.nextTick(function(){initData(e)}):setTimeout(function(){initData(e)},30),Document&&(e.document=new Document("nodes",t.nodes,e)),t.title&&e.data.autosetTitle&&wx.setNavigationBarTitle({title:t.title}),e.imgList=t.imgList,e.triggerEvent("parse",t)}).catch(function(t){e.triggerEvent("error",{source:"parse",errMsg:t})});else if(t.constructor==Array)this.setData({controls:{imgMode:this.data.imgMode},showAnimation:o,hideAnimation:i}),CanIUseNextTick?wx.nextTick(function(){initData(e)}):setTimeout(function(){initData(e)},30),Document&&(this.document=new Document("html",t,this)),this.imgList=[];else if("object"==(void 0===t?"undefined":_typeof(t))){if(!t.nodes||t.nodes.constructor!=Array){if(t.name&&t.children&&t.attrs||"text"==t.type)return;return void this.triggerEvent("error",{source:"parse",errMsg:"传入的nodes数组格式不正确！应该传入的类型是array，实际传入的类型是："+_typeof(t.nodes)})}this.setData({controls:{imgMode:this.data.imgMode},showAnimation:o,hideAnimation:i}),CanIUseNextTick?wx.nextTick(function(){initData(e)}):setTimeout(function(){initData(e)},30),Document&&(this.document=new Document("html.nodes",t.nodes,this)),t.title&&this.data.autosetTitle&&wx.setNavigationBarTitle({title:t.title}),this.imgList=t.imgList||[]}else this.triggerEvent("error",{source:"parse",errMsg:"错误的html类型："+(void 0===t?"undefined":_typeof(t))});else this.setData({nodes:[]})}},autocopy:{type:Boolean,value:!0},autopause:{type:Boolean,value:!0},autopreview:{type:Boolean,value:!0},autosetTitle:{type:Boolean,value:!0},domain:{type:String,value:""},imgMode:{type:String,value:"default"},lazyLoad:{type:Boolean,value:!1},selectable:{type:Boolean,value:!1},tagStyle:{type:Object,value:{}},showWithAnimation:{type:Boolean,value:!1},animationDuration:{type:Number,value:400},useAnchor:{type:Boolean,value:!1}},methods:{tapEvent:function(t){var e=!0;this.triggerEvent("linkpress",{href:t.detail.href,ignore:function(){return e=!1}}),e&&t.detail.href&&("#"==t.detail.href[0]?this.data.useAnchor&&this.navigateTo({id:t.detail.href.substring(1)}):/^http/.test(t.detail.href)?this.data.autocopy&&wx.setClipboardData({data:t.detail.href,success:function(){wx.showToast({title:"链接已复制"})}}):wx.navigateTo({url:t.detail.href}))},errorEvent:function(t){this.triggerEvent("error",t.detail)},previewEvent:function(t){var e=!0;this.triggerEvent("imgtap",{id:t.detail.id,src:t.detail.src,ignore:function(){return e=!1}}),e&&this.data.autopreview&&wx.previewImage({current:t.detail.src,urls:this.imgList.length?this.imgList:[t.detail.src]})},_playVideo:function(t){if(this.videoContext.length>1&&this.data.autopause){var e=!0,i=!1,o=void 0;try{for(var n,a=this.videoContext[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var r=n.value;r.id!=t.detail&&r.context.pause()}}catch(t){i=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(i)throw o}}}}}});