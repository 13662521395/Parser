/* Parser 富文本插件 https://github.com/jin-yufeng/Parser */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Document;try{Document=require("./libs/document.js")}catch(t){}var parseHtmlSync=require("./libs/MpHtmlParser.js").parseHtmlSync,App=getApp(),ready=function(t,e,n){e&&t.data.autosetTitle&&swan.setNavigationBarTitle({title:e}),t.imgList=n||[],setTimeout(function(){t.createSelectorQuery().select("#contain"+t.id).boundingClientRect(function(e){t.triggerEvent("ready",e)}).exec()},50)};Component({attached:function(){var t=this;this.navigateTo=function(e){e.success=e.success||function(){return null},e.fail=e.fail||function(){return null};var n=function(n){var a=t.createSelectorQuery();a.select(n).boundingClientRect(),a.selectViewport().scrollOffset(),a.exec(function(t){if(!t||!t[0])return e.fail({errMsg:"Label Not Found"});swan.pageScrollTo({scrollTop:t[1].scrollTop+t[0].top,success:e.success,fail:e.fail})})};if(e.id){var a=!0,o=!1,i=void 0;try{for(var r,s=t.anchors[Symbol.iterator]();!(a=(r=s.next()).done);a=!0){var l=r.value;l.id==e.id&&n("#"+e.id,l.node)}}catch(t){o=!0,i=t}finally{try{!a&&s.return&&s.return()}finally{if(o)throw i}}}else n("#contain")},this.getText=function(){var e="";if(!t.data.html)return"";var n=!0,a=!1,o=void 0;try{for(var i,r=(t.data.html.nodes||(t.data.html[0].name||t.data.html[0].type?t.data.html:t.data.nodes))[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var s=i.value;!function t(n){if("text"==n.type)return e+=n.text;"p"!=n.name&&"div"!=n.name&&"br"!=n.name||"\n"==e[e.length-1]||(e+="\n");var a=!0,o=!1,i=void 0;try{for(var r,s=n.children[Symbol.iterator]();!(a=(r=s.next()).done);a=!0){t(r.value)}}catch(t){o=!0,i=t}finally{try{!a&&s.return&&s.return()}finally{if(o)throw i}}}(s)}}catch(t){a=!0,o=t}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}return e},this.getVideoContext=function(e){if(!e)return t.videoContexts;var n=!0,a=!1,o=void 0;try{for(var i,r=t.videoContexts[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var s=i.value;if(s.id==e)return s}}catch(t){a=!0,o=t}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}return null},getApp()._Parser=this},properties:{html:{type:null,value:"",observer:function(t){var e={},n={};if(this.data.showWithAnimation&&(e=swan.createAnimation({duration:this.data.animationDuration,timingFunction:"ease"}).opacity(0).step().export(),n=swan.createAnimation({duration:this.data.animationDuration,timingFunction:"ease"}).opacity(1).step().export()),t)if("string"==typeof t){var a;this.data.cacheId?(App.globalData=App.globalData||{},App.globalData[this.data.cacheId]?a=App.globalData[this.data.cacheId]:(a=parseHtmlSync(t,this.data),App.globalData[this.data.cacheId]=a)):a=parseHtmlSync(t,this.data),this.setData({nodes:a.nodes,controls:{},showAnimation:n,hideAnimation:e}),Document&&(this.document=new Document("nodes",a.nodes,this)),this.videoContexts=[],this.anchors=[],this.triggerEvent("parse",a),ready(this,a.title,a.imgList)}else if(t.constructor==Array)this.setData({controls:{},showAnimation:n,hideAnimation:e}),Document&&(this.document=new Document("html",t,this)),this.videoContexts=[],this.anchors=[],ready(this);else if("object"==(void 0===t?"undefined":_typeof(t))){if(!t.nodes||t.nodes.constructor!=Array){if(t.name&&t.children&&t.attrs||"text"==t.type)return;return void this.triggerEvent("error",{source:"parse",errMsg:"传入的nodes数组格式不正确！应该传入的类型是array，实际传入的类型是："+_typeof(t.nodes)})}this.setData({controls:{},showAnimation:n,hideAnimation:e}),Document&&(this.document=new Document("html.nodes",t.nodes,this)),this.videoContexts=[],this.anchors=[],ready(this,t.title,t.imgList)}else this.triggerEvent("error",{source:"parse",errMsg:"错误的html类型："+(void 0===t?"undefined":_typeof(t))});else this.setData({nodes:[]})}},autocopy:{type:Boolean,value:!0},autopause:{type:Boolean,value:!0},autopreview:{type:Boolean,value:!0},autosetTitle:{type:Boolean,value:!0},cacheId:{type:String,value:""},domain:{type:String,value:""},imgMode:{type:String,value:"default"},selectable:{type:Boolean,value:!1},tagStyle:{type:Object,value:{}},showWithAnimation:{type:Boolean,value:!1},animationDuration:{type:Number,value:400},useAnchor:{type:Boolean,value:!1}}});